<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Aframe</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">


  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
  <!-- we import arjs version without NFT but with marker + location based support -->
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
  <script>
    AFRAME.registerComponent('registerevents', {
        init: function () 
        {
            let marker = this.el;
            let follower = document.querySelector("#follower");
            let followerPlane = document.querySelector("#followerPlane");
            
            marker.addEventListener('markerFound', function() {
                // check if marker is found for the first time;
                //  if so, make object visible and align position/rotation.
                if ( follower.getAttribute("active") == "0" )
                {
                    follower.setAttribute("active", "1");
                    followerPlane.setAttribute("material", "visible", "true");   
                }
                markerVisible = true;
            });
    
            marker.addEventListener('markerLost', function() {
                markerVisible = false;
            });
            
            this.p = new THREE.Vector3();
            this.q = new THREE.Quaternion();
            this.s = new THREE.Vector3();   
        },
        
        tick: function (time, deltaTime) 
        {
            // if marker is visible, align the entity to the marker
            if (markerVisible)
            {
                let marker = this.el;
                let follower = document.querySelector("#follower");
                let followerPlane = document.querySelector("#followerPlane");
    
                let lerpAmount = 0.5;
    
                marker.object3D.getWorldPosition(this.p);
          marker.object3D.getWorldQuaternion(this.q);
          marker.object3D.getWorldScale(this.s);
    
          follower.object3D.position.lerp(this.p, lerpAmount);
                follower.object3D.quaternion.slerp(this.q, lerpAmount);
          follower.object3D.scale.lerp(this.s, lerpAmount);
                
                followerPlane.setAttribute("color", "green");
            } 
            else
            {
                followerPlane.setAttribute("color", "red");            
            }
        }
    });
        AFRAME.registerComponent('updater', {
        
            init: function()
            {
                // declare variable for later access
                this.num = 0;
                // you can also access the underlying 3D object of a scene object,
                //   for example:
                // let target = document.querySelector('#earth').object3D;
                // target.scale.set( 0.75, 0.75, 0.75 );
            },
            
            // time      = total time since init (milliseconds)
            // timeDelta = time since last tick
            tick: function (time, timeDelta) 
            {
                this.num += 1;
                // console.log( this.num );
            }
            
        });
        
        // access underlying 3D object this component is attached to
        AFRAME.registerComponent('spinner', {
        
            init: function()
            {
                this.el.object3D.scale.set(0.75, 0.75, 0.75);
            },
            
            tick: function (time, timeDelta) 
            {
                this.el.object3D.rotation.y += 0.01
            }
            
        });
        
        
        </script>
</head>
<body style="margin : 0px; overflow: hidden;">
  
  <app-root>Loading...</app-root>
</body>
</html>